
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>历史地图景观变迁对比（含2024白点按钮与弹框）</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            color: #333;
            background-color: #f8f9fa;
            line-height: 1.6;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 100%;
            padding: 15px;
            gap: 15px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            margin-bottom: 5px;
            gap: 20px;
        }

        .title {
            font-size: 1.6rem;
            font-weight: 600;
            color: #2c3e50;
            white-space: nowrap;
            min-width: 200px;
        }

        .timeline-container {
            display: flex;
            align-items: center;
            flex: 1;
            justify-content: center;
        }

        .timeline {
            display: flex;
            justify-content: space-between;
            width: 100%;
            position: relative;
        }

        .time-marker {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
            background: #fff;
        }

        .time-marker:hover {
            background-color: #f1f3f5;
            transform: translateY(-2px);
        }

        .time-marker.active {
            background-color: #e7f5ff;
            border-color: #339af0;
            font-weight: 600;
            box-shadow: 0 3px 8px rgba(51, 154, 240, 0.15);
        }

        .year {
            font-size: 1.2rem;
            margin-bottom: 4px;
            color: #495057;
        }

        .time-label {
            font-size: 0.85rem;
            color: #868e96;
        }

        .search-box {
            display: flex;
            align-items: center;
            white-space: nowrap;
            min-width: 250px;
        }

        input[type="text"] {
            padding: 10px 14px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin-right: 8px;
            width: 200px;
            font-size: 0.95rem;
            transition: border-color 0.2s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #339af0;
            box-shadow: 0 0 0 3px rgba(51, 154, 240, 0.15);
        }

        button {
            padding: 10px 16px;
            background-color: #4dabf7;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95rem;
            font-weight: 500;
        }

        button:hover {
            background-color: #339af0;
            transform: translateY(-1px);
        }

        .maps-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 15px;
            flex: 1;
            min-height: 0;
        }

        .map-wrapper {
            position: relative;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            overflow: hidden;
            transition: transform 0.3s;
        }

        .map-wrapper:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .map-title {
            position: absolute;
            top: 12px;
            left: 12px;
            background-color: rgba(255, 255, 255, 0.92);
            padding: 6px 12px;
            border-radius: 6px;
            z-index: 1000;
            font-size: 0.9rem;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
            color: #495057;
        }

        .map {
            position: relative; /* 关键：让内部绝对定位元素相对map定位 */
            height: 100%;
            width: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            cursor: grab;
            transition: transform 0.1s ease;
            overflow: hidden;
            user-select: none;
        }

        .map.dragging {
            cursor: grabbing;
        }

        .fullscreen-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            z-index: 1000;
            background-color: rgba(255, 255, 255, 0.92);
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            transition: all 0.2s;
            color: #495057;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
        }

        .fullscreen-btn:hover {
            background-color: rgba(255, 255, 255, 1);
            color: #339af0;
        }

        footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            margin-top: 5px;
        }

        .legend {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .color-box {
            width: 18px;
            height: 18px;
            border-radius: 3px;
            border: 1px solid #dee2e6;
        }

        .options {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* 全屏模式样式 */
        .map-wrapper.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            border-radius: 0;
        }

        .map-wrapper.fullscreen .map {
            height: 100%;
        }

        .map-wrapper.fullscreen .fullscreen-btn {
            display: none;
        }

        .map-wrapper.fullscreen .exit-fullscreen-btn {
            display: block;
        }

        .exit-fullscreen-btn {
            display: none;
            position: absolute;
            top: 12px;
            right: 12px;
            z-index: 1000;
            background-color: rgba(255, 255, 255, 0.92);
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            transition: all 0.2s;
            color: #495057;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
        }

        .exit-fullscreen-btn:hover {
            background-color: rgba(255, 255, 255, 1);
            color: #339af0;
        }

        .center-btn {
            position: absolute;
            top: 55px;
            right: 12px;
            z-index: 1000;
            background-color: rgba(255, 255, 255, 0.92);
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            transition: all 0.2s;
            color: #495057;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
        }

        .center-btn:hover {
            background-color: rgba(255, 255, 255, 1);
            color: #339af0;
        }

        .zoom-controls {
            position: absolute;
            bottom: 15px;
            left: 15px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .zoom-btn {
            background-color: rgba(255, 255, 255, 0.92);
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.2s;
            color: #495057;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .zoom-btn:hover {
            background-color: rgba(255, 255, 255, 1);
            color: #339af0;
        }

        /* --- 2024白点按钮 & 弹框样式 --- */
        #buttons-layer {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* 让拖拽可穿透，按钮自己再开启 */
            z-index: 100; /* 在底图之上 */
        }
        .map-button {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #fff;
            border-radius: 50%;
            border: 2px solid #cfcfcf;
            box-shadow: 0 3px 10px rgba(0,0,0,.15);
            cursor: pointer;
            transform: translate(-50%, -50%);
            pointer-events: auto; /* 允许点击/悬停 */
            overflow: visible; /* 允许波纹超出按钮 */
        }
        .map-button:hover {
            border-color: #4dabf7;
            box-shadow: 0 4px 14px rgba(77,171,247,.45);
         }

        /* 点击波纹动画元素 */
        .map-button .click-ripple {
            position: absolute;
            left: 50%;
            top: 50%;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(1);
            border: 2px solid #4dabf7;
            background: rgba(77,171,247,0.12);
            box-shadow: 0 0 0 2px rgba(77,171,247,0.15);
            pointer-events: none;
            animation: click-ripple 700ms ease-out forwards;
        }

        @keyframes click-ripple {
            0% {
                opacity: .8;
                transform: translate(-50%, -50%) scale(1);
                box-shadow: 0 0 0 2px rgba(77,171,247,0.15);
            }
            70% {
                opacity: .25;
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(3.2);
                box-shadow: 0 0 0 0 rgba(77,171,247,0);
            }
        }

        /* 
        .map-tooltip {
            position: absolute;
            left: 50%;
            bottom: 100%;
            transform: translate(-50%, -8px);
            background: rgba(255,255,255,.98);
            border: 1px solid rgba(0,0,0,.1);
            padding: 8px 10px;
            font-size: 12px;
            line-height: 1.45;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,.18);
            min-width: 160px;
            max-width: 260px;
            opacity: 0;
            visibility: hidden;
            transition: opacity .15s ease, transform .15s ease;
            pointer-events: none;
            color: #2c3e50;
            z-index: 2000;
            text-align: left;
        }
        .map-tooltip::after{
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 7px solid transparent;
            border-top-color: #fff;
            filter: drop-shadow(0 -1px 1px rgba(0,0,0,.08));
        }
        .map-button:hover .map-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -12px);
        } */

        /* 响应式设计 */
        @media (max-width: 900px) {
            .maps-container {
                grid-template-columns: 1fr;
                grid-template-rows: repeat(4, 1fr);
            }

            header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .timeline-container {
                width: 100%;
                margin: 10px 0;
            }

            .search-box {
                width: 100%;
                margin-top: 10px;
                min-width: auto;
            }

            .title {
                min-width: auto;
                align-self: center;
            }

            input[type="text"] {
                flex: 1;
            }

            .timeline {
                flex-wrap: wrap;
                gap: 10px;
                justify-content: center;
            }

            .time-marker {
                flex: 1;
                min-width: 120px;
            }

            footer {
                flex-direction: column;
                gap: 15px;
            }

            .legend {
                flex-wrap: wrap;
                justify-content: center;
            }
        }


        /* --- 右侧可移动介绍面板 --- */
        .info-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 600px;
            max-height: 80vh;
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            padding: 15px;
            overflow-y: auto;
            z-index: 10000;
            display: none;

            /* 初始隐藏状态（用于无动画展示前的起点） */
            opacity: 0;
            transform: translateY(24px) scale(0.92);
        }

        .info-panel.show {
            display: block;
            opacity: 1;
            transform: none;
            /* 更明显的弹出动画 */
            animation: panel-pop 420ms cubic-bezier(.22,1.15,.32,1) both;
        }

        .info-panel.hiding {
            /* 平滑缩回动画 */
            animation: panel-hide 260ms cubic-bezier(.4,.0,.2,1) both;
        }

        @keyframes panel-pop {
            0% {
                opacity: 0;
                transform: translateY(24px) scale(0.92);
                box-shadow: 0 4px 12px rgba(0,0,0,0.18);
            }
            60% {
                opacity: 1;
                transform: translateY(-6px) scale(1.02);
                box-shadow: 0 14px 32px rgba(0,0,0,0.22);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
                box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            }
        }

        @keyframes panel-hide {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
                box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            }
            100% {
                opacity: 0;
                transform: translateY(12px) scale(0.96);
                box-shadow: 0 4px 12px rgba(0,0,0,0.12);
            }
        }

        .info-panel-header {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 10px;
            cursor: move; /* 提示可拖动 */
        }
        .info-panel-close {
            position: absolute;
            top: 8px;
            right: 10px;
            cursor: pointer;
            font-size: 16px;
            color: #888;
        }
        .info-panel-close:hover {
            color: #000;
        }

    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="title">地图景观变迁对比</div>
            <div class="timeline-container">
                <div class="timeline">
                    <div class="time-marker" data-year="1861">
                        <span class="year">1861</span>
                        <span class="time-label">163年前</span>
                    </div>
                    <div class="time-marker" data-year="1938">
                        <span class="year">1938</span>
                        <span class="time-label">86年前</span>
                    </div>
                    <div class="time-marker" data-year="1966">
                        <span class="year">1966</span>
                        <span class="time-label">58年前</span>
                    </div>
                    <div class="time-marker active" data-year="2024">
                        <span class="year">2024</span>
                        <span class="time-label">现在</span>
                    </div>
                </div>
            </div>
            <div class="search-box">
                <input type="text" placeholder="输入地点名称..." id="location-search">
                <button id="search-btn">定位</button>
            </div>
        </header>

        <div class="maps-container">
            <div class="map-wrapper">
                <div class="map-title">2024年</div>
                <button class="fullscreen-btn" data-map="map-2024">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="exit-fullscreen-btn">
                    <i class="fas fa-compress"></i>
                </button>
                <button class="center-btn" data-map="map-2024">
                    <i class="fas fa-crosshairs"></i>
                </button>
                <div class="zoom-controls">
                    <button class="zoom-btn" data-map="map-2024" data-action="zoom-in">+</button>
                    <button class="zoom-btn" data-map="map-2024" data-action="zoom-out">-</button>
                </div>
                <div id="map-2024" class="map" style="background-image: url('wcx/2024.png');">
                    <!-- 关键：按钮层 -->
                    <div id="buttons-layer"></div>
                </div>
            </div>
            <div class="map-wrapper">
                <div class="map-title">1966年</div>
                <button class="fullscreen-btn" data-map="map-1966">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="exit-fullscreen-btn">
                    <i class="fas fa-compress"></i>
                </button>
                <button class="center-btn" data-map="map-1966">
                    <i class="fas fa-crosshairs"></i>
                </button>
                <div class="zoom-controls">
                    <button class="zoom-btn" data-map="map-1966" data-action="zoom-in">+</button>
                    <button class="zoom-btn" data-map="map-1966" data-action="zoom-out">-</button>
                </div>
                <div id="map-1966" class="map" style="background-image: url('wcx/1966.png');"></div>
            </div>
            <div class="map-wrapper">
                <div class="map-title">1938年</div>
                <button class="fullscreen-btn" data-map="map-1938">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="exit-fullscreen-btn">
                    <i class="fas fa-compress"></i>
                </button>
                <button class="center-btn" data-map="map-1938">
                    <i class="fas fa-crosshairs"></i>
                </button>
                <div class="zoom-controls">
                    <button class="zoom-btn" data-map="map-1938" data-action="zoom-in">+</button>
                    <button class="zoom-btn" data-map="map-1938" data-action="zoom-out">-</button>
                </div>
                <div id="map-1938" class="map" style="background-image: url('wcx/1938.png');"></div>
            </div>
            <div class="map-wrapper">
                <div class="map-title">1861年</div>
                <button class="fullscreen-btn" data-map="map-1861">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="exit-fullscreen-btn">
                    <i class="fas fa-compress"></i>
                </button>
                <button class="center-btn" data-map="map-1861">
                    <i class="fas fa-crosshairs"></i>
                </button>
                <div class="zoom-controls">
                    <button class="zoom-btn" data-map="map-1861" data-action="zoom-in">+</button>
                    <button class="zoom-btn" data-map="map-1861" data-action="zoom-out">-</button>
                </div>
                <div id="map-1861" class="map" style="background-image: url('wcx/1861.png');"></div>
            </div>
        </div>

        <footer>
            <div class="legend"></div>
            <div class="options">
                <div class="toggle">
                    <button id="sync-maps">锁定地图</button>
                </div>
            </div>
        </footer>
        <div id="info-panel" class="info-panel">
            <div class="info-panel-close">&times;</div>
            <div class="info-panel-header">标题</div>
            <div class="info-panel-content">内容</div>
        </div>
        
        <div style="width: 100%; text-align: center; font-size: 10px; color: #999; margin-top: 1px;">
            wcx @mxy 2025.8.25
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script>
        // 初始化变量
        let maps = {};
        let activeMap = null;
        let isSyncing = true;
        let fullscreenMode = false;
        let zoomLevels = {
            'map-2024': 2,
            'map-1966': 2,
            'map-1938': 2,
            'map-1861': 2
        };
        let mapPositions = {
            'map-2024': { x: 0, y: 0 },
            'map-1966': { x: 0, y: 0 },
            'map-1938': { x: 0, y: 0 },
            'map-1861': { x: 0, y: 0 }
        };
        let isDragging = false;
        let dragStart = { x: 0, y: 0 };
        let currentDragMap = null;

        // 初始化地图
        function initMap(mapId) {
            const mapElement = document.getElementById(mapId);
            maps[mapId] = mapElement;

            // 设置第一个地图为活跃地图
            if (!activeMap) {
                activeMap = mapElement;
                document.querySelector(`[data-year="2024"]`).classList.add('active');
            }

            // 应用初始缩放
            updateMapTransform(mapId);

            return mapElement;
        }

        // 同步所有地图视图
        function syncMaps(sourceMap) {
            const sourceId = Object.keys(maps).find(key => maps[key] === sourceMap);
            if (!sourceId) return;

            const sourceZoom = zoomLevels[sourceId];
            const sourcePosition = mapPositions[sourceId];

            for (const id in maps) {
                if (id !== sourceId) {
                    zoomLevels[id] = sourceZoom;
                    mapPositions[id] = { ...sourcePosition };
                    updateMapTransform(id);
                }
            }
        }

        // 更新地图缩放和位置
        function updateMapTransform(mapId) {
            const mapElement = maps[mapId];
            const zoom = zoomLevels[mapId];
            const position = mapPositions[mapId];
            mapElement.style.transform = `translate(${position.x}px, ${position.y}px) scale(${zoom})`;
            mapElement.style.transformOrigin = 'center center';
        }

        // 设置活跃地图
        function setActiveMap(map) {
            activeMap = map;

            // 更新时间轴活跃状态
            document.querySelectorAll('.time-marker').forEach(marker => {
                marker.classList.remove('active');
            });

            // 根据地图ID找到对应的时间标记
            let year;
            if (map === maps['map-2024']) year = '2024';
            else if (map === maps['map-1966']) year = '1966';
            else if (map === maps['map-1938']) year = '1938';
            else if (map === maps['map-1861']) year = '1861';

            if (year) {
                document.querySelector(`[data-year=\"${year}\"]`).classList.add('active');
            }
        }

        // 缩放功能
        function zoomMap(mapId, direction) {
            const currentZoom = zoomLevels[mapId];
            let newZoom = currentZoom;

            if (direction === 'in') {
                newZoom = Math.min(currentZoom * 1.2, 5); // 最大放大5倍
            } else if (direction === 'out') {
                newZoom = Math.max(currentZoom / 1.2, 0.3); // 最小缩小到0.3倍
            }

            zoomLevels[mapId] = newZoom;
            updateMapTransform(mapId);

            // 如果同步功能开启，同步其他地图
            if (isSyncing && !fullscreenMode) {
                syncMaps(maps[mapId]);
            }
        }

        // 回归中心点功能
        function centerMap(mapId) {
            mapPositions[mapId] = { x: 0, y: 0 };
            zoomLevels[mapId] = 1;
            updateMapTransform(mapId);

            // 如果同步功能开启，同步其他地图
            if (isSyncing && !fullscreenMode) {
                syncMaps(maps[mapId]);
            }
        }

        // 全屏功能
        function toggleFullscreen(mapId) {
            const mapWrapper = document.querySelector(`#${mapId}`).closest('.map-wrapper');

            if (!document.fullscreenElement) {
                // 进入全屏模式
                if (mapWrapper.requestFullscreen) {
                    mapWrapper.requestFullscreen();
                } else if (mapWrapper.webkitRequestFullscreen) {
                    mapWrapper.webkitRequestFullscreen();
                } else if (mapWrapper.msRequestFullscreen) {
                    mapWrapper.msRequestFullscreen();
                }

                mapWrapper.classList.add('fullscreen');
                fullscreenMode = true;
            } else {
                // 退出全屏模式
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }

                mapWrapper.classList.remove('fullscreen');
                fullscreenMode = false;
            }
        }

        
        const pointData = [
            {x: 54.9, y: 13.0, title: '1.长堤街', desc: `
      <p>长堤街位于汉正街以北，跨硚口、江汉两区，与之平行的南为沿河大道和汉正街，北为中山大道，西与硚口路相交，东与黄陂街相接，长约5公里，宽5～7米，水泥路面。该街由后湖堤（长堤）演变而成，故称长堤街。</p>
      <img src="example1.jpg" style="width:100%;border-radius:6px;margin:8px 0;">
      <p>一、起源背景（明代至清代）
        修建时间：明崇祯八年（1635年）
        修建者：汉阳通判袁焻（又称袁公）
        原名：袁公堤
        功能：

        抵御后湖（今中山大道以北）水患，保护汉口镇免受洪水侵袭。
        堤坝修筑后，堤内形成可开发用地，促进了汉口镇向北扩展。
        地理位置：
        北起硚口，南至堤口（今王家巷附近），全长约十里。
        堤外挖有“玉带河”，形成一道人工水系，兼具防洪与交通功能。
        历史意义：
        是汉口最早的防洪工程之一，也是汉口城市空间向北扩张的重要标志。
        堤坝逐渐演变为街道，即今天的长堤街。

        二、现状（截至论文撰写时）
        位置：位于药王庙街区北侧，是街区的北边界。
        街道特征：
        长约240米，宽约6.4米。
        清代已成街，至今仍保留历史名称与部分街巷肌理。
        功能：
        历史上为商业与居住混合街道。
        现仍为社区内部道路，两侧多为居民楼与小商业铺面。
        文化价值：
        作为汉口历史街道的重要组成部分，承载了明清以来汉口城市发展的历史记忆。

        三、变迁过程
        明代至清代：
        从防洪堤坝逐渐演变为街道，成为汉口镇北侧的重要通道。
        堤坝两侧逐渐形成民居与商铺，街市逐渐繁荣。
        清末至民国：
        随着汉口堡（1864年）和张公堤（1905年）的修建，袁公堤逐渐失去防洪功能，完全转变为城市街道。
        街道名称由“袁公堤”逐渐演变为“长堤街”。
        建国后至改革开放：
        长堤街作为历史街道，保留了较多的传统街巷格局和建筑风貌。
        部分路段在城市建设中有所调整，但整体走向与名称未变。
        现代（至2024年）：
        长堤街仍作为药王庙街区的北界道路存在。
        街道两侧建筑多为民国至建国初期的砖木结构房屋，部分区域面临旧城改造压力。
        在汉正街整体更新背景下，长堤街作为历史脉络的一部分，具有一定的保护与更新价值。<a href="#">查看更多</a></p>
    `},
            {x: 82.9, y: 31.1, title: '2.横堤上街', desc: `
      <p>Hengdi Shangjie 位于硚口区长堤街东段与大夹街之间。南北走向。北起长堤街，南至人和街。长240米，宽6.4米。沥青路面。可行汽车。门牌1－83号；2－92号。跨硚口、江汉二区。清同治间成街。垂直于长堤街，称横堤街。20年代，今横堤下街形成，此街改称横堤上街。1967年改名工农兵一街，1972年横堤大巷开入，复名横堤上街。两侧多老式板壁房屋，居民稠密，晒台巷、公寿前、后街、人和街、江口巷与此巷相通。分布有商业和服务网点。</p>
      <img src="example1.jpg" style="width:100%;border-radius:6px;margin:8px 0;">
      <p> 一、起源背景（清代）
        命名由来：其名称直接源于其与长堤街（袁公堤） 的空间关系。“横堤”意为“横亘于堤街之上”或“与堤街垂直”，清晰地指明了该街道与长堤街垂直相交的走向。
        形成时间：清代（具体年份论文未明确提及，但其形成与药王庙街区的发育和长堤街的稳定密切相关）。
        功能与位置：
        是药王庙街区东侧的纵向边界道路，东与江汉区接壤。在传统商业时期，作为街区骨架路网的重要组成部分，连接南北，起到了划分街区、组织交通的作用。

        二、现状（截至论文撰写时）
        位置：位于药王庙街区东侧，是街区与相邻区域的界路。
        街道特征：
        论文中提及长度约为240米，宽约6.4米。
        至今仍保留其历史名称与基本走向。
        功能：
        目前仍作为社区内部道路使用，承担着一定的交通功能。两侧建筑为不同历史时期层积的结果，可能包含民宅和小型商铺。

        三、变迁过程
        清代形成与稳定：
        随着药王庙街区在清代的发展成熟，其路网结构逐渐固化。横堤上街作为垂直于长堤街（主街）的“巷”一级道路，成为街区肌理中稳定的组成部分。
        民国时期至今：
        稳定性高：与街区内部一些因湖泊填埋、战争损毁后重建而发生变化的小巷不同，横堤上街作为街区的主要边界，其位置和走向在历史舆图（从1864年至近代地图）和现实中都表现出极高的稳定性。
        边界功能的延续：论文中在划分药王庙街区的精确边界时，多次将横堤上街列为东侧边界，证明了其作为空间界限的功能从古至今未有改变。
        现代语境下的变化：论文在“市场经济时期”部分提到，在友谊南路等现代道路的修建过程中，街区东侧的大陶家巷、江口巷等巷道被占据消亡。而横堤上街作为更主要的巷道得以保留，但其东端可能与新的城市干道（如友谊南路）形成了新的交接关系，其城市语境从传统的街区内部界路，转变为历史街区与现代城市空间的过渡带。<a href="#">查看更多</a></p>
        `},
            {x: 79.5, y: 42.6, title: '4.公寿前后街', desc: `
      <p>【公寿前街】Gongshou Qianjie 位于硚口区东南部，长堤街与大夹街之间。东北至西南走向，东北自横堤上街，西南至六水街，长61米，宽3.3米。水泥路面。不通汽车。门牌1-19号。清代成巷，昔有宫寿祠，称宫寿祠前街。30年代简为宫寿前街。1967年改名仇帝二街，1972年以谐音改名公寿前街。房屋陈旧。</p>
      <p> 【公寿后街】Gongshou Houjie 位于硚口区长堤街东段和大夹街之间，横堤上街西南侧。片状居民区，西接新安街北段，北至公寿前街，南出人和街。面积约1500平方米。主巷道南北向，弯曲偏窄，可行非机动车辆。门牌1-19号；2-18号。清末成街。昔近有宫寿祠，称宫寿祠后街。30年代初改称宫寿后街。1967年改名仇帝三街。1972年以谐音改名公寿后街。多低矮平房，居民稠密。</p>
      <img src="example1.jpg" style="width:100%;border-radius:6px;margin:8px 0;">
      <p>一、起源背景（民国初期）
        命名由来：两条街道均因公寿祠而得名。公寿祠是药王庙街区下闸口片区内的一个历史建筑或场所。
        形成时间：民国初年（论文未提供公寿祠的确切建造年代，但街道在1920年代的舆图中已明确标注，可知其形成于民国初期）。
        功能与位置：
        位于药王庙街区的下闸口片区（即覃怀药王庙东侧街区）。
        公寿前街：东西走向，连接了晒台街和六水街，形成了该片区一个独特的三角形街口空间节点。
        公寿后街：推测位于公寿祠后方，与公寿前街形成前后对应关系。论文中提及徽州会馆（新安书院）的西界为“公寿后街西”，说明其也是街区路网的组成部分。
        其功能主要是服务于公寿祠的交通与空间组织，并作为该区域的里巷通道。
        二、现状（截至论文撰写时）
        存续状态：已消失。
        消失原因：
        论文在“下闸口街区”部分明确提到：仁寿里、保善里、亲仁里等里分（包括公寿祠及相关的街道）均在修建武汉市第四十四中学时被废除。
        武汉市第四十四中学于1957年在新安公所（淮提庵）原址开办。可以推断，为建设校舍，其周边的历史街巷肌理（包括公寿祠、公寿前街、公寿后街）被大规模拆除和平整。
        原址现状：原址已被学校及其附属设施所覆盖，历史街道的痕迹已无存。
        三、变迁过程
        民国时期：出现与存在
        在1926年、1928年的历史地图（如《武汉三镇街市详图》）上，可以清晰地看到“公寿祠”以及“公寿前街”和“公寿后街”的标注。
        这一时期，它们是该区域历史街巷肌理中活跃的一部分，与周边的晒台庵、新安公所、以及众多里弄（如仁寿里、保善里）共同构成了密集而丰富的街区景观。
        计划经济时期（1950年代后）：消亡
        1957年，随着武汉市第四十四中学的建立，一场大规模的城市改造在此发生。
        为了给新的公共教育设施腾出空间，原有的历史建筑（公寿祠、新安淮提庵等）和历史街巷格局（包括公寿前街、公寿后街）被拆除和重新规划。这是计划经济时期“单位”体制垂直介入城市空间的典型体现。国家的意志（兴办教育）直接改变了微观街区的物质形态，导致了历史层积的中断和覆盖。
        市场经济时期至今：痕迹消失
        原有的街道肌理彻底被现代化的学校园区所取代，没有任何物质形态留存。
        其名称仅存在于历史地图和文献记载中，成为该地块历史记忆的一个注脚。<a href="#">查看更多</a></p>
    `},
            {x: 74.3, y: 33.4, title: '6.晒台街', desc:`
      <p></p>
      <img src="example1.jpg" style="width:100%;border-radius:6px;margin:8px 0;">
      <p>一、起源背景（清代）
        命名由来：因晒台庵而得名。
        形成时间：清代（具体年份论文未明确提及，但其成巷于清代）。
        功能与位置：
        位于下闸口街区（覃怀药王庙东侧街区）。
        是一条南北走向的街道，北起长堤街，南至六水街，长约110米，宽约4米。
        在历史上，它与东侧的横堤上街、西侧的药帮大巷等共同构成了该区域的次级街巷网络。
        二、现状（截至论文撰写时）
        位置与形态：
        仍然存在，保留了其历史名称和基本走向。
        论文中描述其长约110米，宽约4米，不通汽车，尺度上保持着传统巷道的特征。
        功能：
        作为社区内部的步行通道和生活性街巷。
        两侧建筑为不同历史时期层积的结果。
        文化价值：
        其名称是街区历史记忆的活化石，直接指向已消失的历史建筑“晒台庵”。
        是药王庙街区历史街巷肌理中保存下来的重要组成部分。
        三、变迁过程
        清代：因庵得名，街巷形成
        晒台庵建立后，其门前的道路因之得名，形成了晒台街。这是典型的“因建筑成巷”的自发形成模式。
        民国时期（1911年后）：见证建筑革新
        关键事件：1911年辛亥革命期间的汉口大火，烧毁了原新安准提庵等大量建筑。
        晒台庵的重建：新安公所在原址重建建筑时，仿照西方建筑形式及砖混结构，并在屋脊处修筑了西式晒台，故得名“晒台庵”。这使得晒台街的得名源头本身，就成为西方技术楔入的见证。
        此时，晒台街作为通往这座新颖混合风格建筑的通道，其街巷功能得到延续和强化。
        计划经济时期至今：肌理的保留与语境的变迁
        肌理保留：与公寿前街等被完全拆除的街巷不同，晒台街的物理空间得以保留下来，并未在后续的学校建设或城市改造中被抹去。
        语境变迁：虽然街道还在，但其得名之源——晒台庵——论文中未提及它的现存状况，很可能也已消失。因此，晒台街从一个“有实有名”的完整历史空间，转变为一条“名存实亡”（“实”指得名之源）的街道，其名称成为对已消失历史建筑的最后记录。
        街道两侧的建筑也经历了从传统民居、商铺到可能夹杂现代砖混建筑的更替，但其作为小巷的基底尺度得以延续。<a href="#">查看更多</a></p>
    `},
            {x: 63.0, y: 44.0, title: '7.六水街', desc: `
      <p></p>
      <img src="example1.jpg" style="width:100%;border-radius:6px;margin:8px 0;">
      <p>一、起源背景（清代）
        命名由来：论文中未明确解释“六水”的具体含义。推测可能与当地历史水文特征（如附近曾有水塘、沟渠）或某种历史典故有关。
        形成时间：清代（论文中明确提及“清代成街”）。
        功能与位置：
        位于药王庙街区的南部，是下闸口街区和徽州会馆街区的南侧边界道路。
        在历史上，它是一条东西向的重要通道，东起横堤上街附近，西至药帮大巷，长约154米，宽约5米。
        它构成了药王庙街区南部的一个关键“界带”，北侧毗邻新安公所（淮提庵）、公寿祠等重要建筑。
        二、现状（截至论文撰写时）
        位置与形态：
        仍然存在，保留了其历史名称、基本走向和街道尺度。
        论文中描述其长约154米，宽约5米，是目前药王庙街区保存下来的历史主巷之一。
        功能：
        现仍作为社区内部道路使用。
        其作为街区南部边界的功能依然清晰。
        文化价值：
        是药王庙街区历史街巷格局中保存最为完好、稳定的骨干街道之一。
        它的存在，与已消失的公寿街、大陶家小巷等形成鲜明对比，是界定街区历史范围的关键要素。
        三、变迁过程
        清代：作为街区南部主干道形成
        六水街随着清代药王庙街区的繁荣而发展成为稳定的街道，作为街区南部的骨架，串联起多个公所会馆（如新安公所）和里弄的入口。
        民国时期：延续与稳定
        在1912年大火及后续的重建过程中，六水街的走向和位置没有发生重大改变，显示了其结构的稳定性。它继续作为该区域重要的内部通道。
        计划经济时期：功能语境的转变
        关键事件：1957年，其北侧的新安公所（淮提庵）原址上开办了武汉市第四十四中学。
        变迁影响：这一事件虽然彻底改变了北侧街区的肌理（公寿街等被废除），但六水街作为南侧边界得以完整保留。它的功能从“服务于公所建筑群的内部街道”，转变为“学校南侧的边界道路”，其空间角色发生了转换但形态得以存续。
        市场经济时期至今：肌理的顽强存续
        在现代城市建设中，六水街再次展现了韧性。当东侧的大陶家小巷等因为友谊南路的修建而被吞噬时，六水街因其是东西向通道，且可能不在道路建设的红线范围内，再次得以幸免。
        如今，它作为历史街区内部保存完好的传统街巷，两侧虽然也是不同时期的建筑层积，但街道本身的 historical integrity（历史完整性）非常高。<a href="#">查看更多</a></p>
    `},
            {x: 48.8, y: 34.0, title: '8.药帮大巷', desc: `
      <p>Yaobang Daxiang 位于硚口区长堤街东段南侧。北起长堤街，南至药帮二巷。长约155米，宽约4米，水泥路面，门牌1－27号；2－66号。系清代古巷，清康熙二十八年（1689），河南怀庆府属武陟、温县、孟县等县药商兴建怀庆会馆，并在此巷附近兴建药王庙，称罩怀药王庙。庙东建有别墅，名豫成园。园内楼台亭阁，山水花木，别有天地，此园早毁，现六水街口路侧，尚留有残存的汉白玉雕花石砌。以药王庙颇具影响，街巷形成之初，多泛称“药王庙”或药帮巷，盛时聚集药材行七十余家，药铺一百多家。药帮巷支巷衍生，此巷又称药帮大巷，沿用至解放后。1967年改名“抗美大巷”。1972年复名药帮大巷（怀安南里并入）。解放后，药王庙庙产归公，原有建筑大多拆除，1954年，原庙址改建为药帮巷小学，原大殿前的汉白玉石雕游龙仍埋在操场内，校后残留的部分建筑已改为民房，校内后操场墙壁上，现有两块石碑，碑文记述了药王庙的修建年代及范围。两侧今仍多老式楼房，居民稠密，巷道狭窄，不通汽车。</p>
      <img src="example1.jpg" style="width:100%;border-radius:6px;margin:8px 0;">
      <p>一、起源背景（清代）
        命名由来：名称直接源于“药帮”，即由河南怀庆府药商组成的“覃怀帮”。该巷是药帮成员开设店铺、进行药材贸易的核心区域。
        形成时间：清代（随覃怀药王庙的建立和药帮的繁荣而形成）。
        功能与位置：
        是药王庙街区最西侧的南北向骨干巷道（骨巷）。
        北起长堤街，南至汉正街，长约155米，宽约4米。
        是覃怀药王庙（西侧）与山陕西会馆（东侧）的分界线，同时也是连接街区北部（长堤街）与南部核心商业区（汉正街）的重要通道。
        其本质是药王庙街区因业成街的典型代表，是药材行业活动的空间载体。
        二、现状（截至论文撰写时）
        位置与形态：
        部分存续。其北段和中段仍然存在，保留了历史名称和巷道尺度（不通汽车）。
        论文中描述其长约155米，宽约4米。
        功能：
        作为社区内部的生活性巷道。
        但其作为全国性药材贸易中心的核心功能已完全消失。
        文化价值：
        其名称是药王庙街区行业起源和历史身份最直接的标志。
        保留下来的区段仍是街区历史空间结构的关键组成部分。
        三、变迁过程
        清代：因业成街，繁荣鼎盛
        随着1689年覃怀药王庙的建立，怀庆药商以此为核心聚集，药帮大巷及其周边的药帮一、二、三巷逐渐形成，成为汉口乃至华中地区著名的药材市场。
        街道两侧药肆林立，是行业精英聚集的专业街巷，功能单一且繁荣。
        民国时期：功能延续与肌理混杂
        药材贸易功能依然存在，但街区的整体建筑肌理开始混杂。巷内及周边开始出现里分建筑（如复元里），居住功能开始嵌入。
        1911年大火后，其西侧的山陕西会馆片区也进行了重建，药帮大巷作为界巷的功能保持不变。
        计划经济时期：行业功能消亡与肌理留存
        私营药材贸易被公有制取代，药帮大巷作为行业交易通道的核心功能彻底消亡。
        但其作为交通巷道的物质空间得以保留，两侧建筑可能转变为纯居住或小规模街办工厂之用。
        市场经济时期（1990年代）：肌理的部分消亡
        这是药帮大巷物质空间遭受最严重、最直接冲击的时期。
        西侧拆除：1993年，其西侧的整个山陕西会馆街区被拆除，兴建了“武汉汉正街品牌服饰批发商场”。这次改造使药帮大巷的西侧界面从历史建筑变为现代商场的外墙或背立面。
        南段切断：1998年，其南端（汉正街路口）因多福路扩建工程而被占据和改造。多福路是一条现代城市道路，它的修建很可能截断或大幅改变了药帮大巷南端的路口形态，使其失去了与汉正街的直接历史联系。
        结果：药帮大巷的肌理在南北两端都受到了现代城市开发的冲击，其完整的历史空间环境已被破坏，但巷道中段仍然幸存。<a href="#">查看更多</a></p>
    `},
            {x: 61.3, y: 67.2, title: '9.药帮一巷', desc: `
      <p>Yaobang 1 - Xiang 位于硚口区东南部，长堤街东段与大夹街之间。东西走向，东起新安后街，西至大生巷。长150米，宽3米，水泥路面。门牌1 - 35号；2 - 20号。清代成巷，附近有河南怀庆府药材帮商户所建怀庆会馆（又称药帮会馆），药材商行多聚集于此，故称药帮巷。因支巷衍生交错，又分称大巷及一、二、三巷，此巷名药帮一巷。1967年改名灭帝巷，1972年复名药帮一巷。房屋较整齐，居民稠密，巷道狭窄，不通汽车。</p>
      <img src="example1.jpg" style="width:100%;border-radius:6px;margin:8px 0;">
      <p>一、起源背景（清代）
        命名由来：名称直接源于“药帮”，是覃怀药帮在药王庙街区形成的放射状巷弄系统的重要组成部分。其序号“一”表明了它在药帮巷弄网络中的核心或首要位置。
        形成时间：清代（随覃怀药王庙的建立和药帮活动范围的扩展而形成，晚于药帮大巷）。
        功能与位置：
        位于覃怀药王庙的东南侧，是一条东西走向的巷道。
        它是划分北侧（祖师殿、元宁公所、浙宁公所、琴溪书院等会馆区）和南侧（贺公祠、徽州会馆区）功能的重要界带。
        与药帮大巷、二巷、三巷共同构成了药帮的专用通道和地缘范围，是行业权力在空间上的体现。
        二、现状（截至论文撰写时）
        位置与形态：
        仍然存在，保留了其历史名称和基本走向。
        论文中虽未明确其尺度和详细现状，但作为药帮巷系统的一部分，其形态应类似药帮大巷，属于狭窄的传统巷道。
        功能：
        从全国性药材行业的专用通道，转变为普通的社区内部生活巷道。
        文化价值：
        其名称是药帮在药王庙街区空间影响力的直接证明，是“药帮”这一历史主题的关键载体之一。
        它作为历史边界的功能依然清晰，是理解街区历史功能分区的重要坐标。
        三、变迁过程
        清代：行业地界的标识
        药帮一巷作为药帮势力范围的东南延伸而被命名和固化。它并非像药帮大巷那样是商业主干道，而更像是药帮领域的“内界线”，标识出药帮活动的核心区域边界。
        民国时期：肌理的混杂与延续
        其空间形态得以延续。随着1911年大火后里分建筑的兴建，其周边区域（如天成里、顺德里等）的居住功能增强，但其作为东西向通道和边界的功能没有改变。
        计划经济时期：功能消亡与肌理留存
        药材贸易的公有制改革使药帮一巷的行业功能彻底消亡。
        其物质空间得以保留，成为普通居民区的通道。论文中提到，1966年在其北侧单元格（原琴溪书院、伏波宫、三皇殿旧址）上修建了“二色织布厂”，但药帮一巷作为厂区南侧的边界道路被保留下来。
        市场经济时期至今：肌理的存续与环境的变迁
        肌理的存续：与药帮大巷西侧和南端被大规模改造不同，药帮一巷深嵌于街区内部，未受到现代道路（如多福路、友谊南路）扩建的直接冲击，因此其整体肌理和街道界面得到了更好的保存。
        环境的变迁：其两侧建筑经历了自然更替，但整体尺度仍保持着历史风貌。其作为历史边界的功能依然有效，但边界两侧的内容已从会馆变为民宅和小型作坊。<a href="#">查看更多</a></p>
    `},
            {x: 39.7, y: 56.0, title: '10.药帮二巷', desc: `
      <p>Yaobang 2 - Xiang 位于硚口区东南部，长堤街东段与大夹街之间。东西走向，西起全新街，东至药帮大巷南端，折东延伸约12米，北端无出口。长113米，宽3米，水泥路面。门牌1 - 21号；2 - 52号。清代成巷，附近有河南怀庆府药材帮会馆怀庆会馆（又称药帮会馆），药材商行多聚集于此，故称药帮巷。因支巷衍生交错，又分称大巷和一、二、三巷，此巷称药帮二巷。1967年改名抗美巷，1972年复名药帮二巷（杜家巷并入）。巷道弯曲窄狭，不通汽车。</p>
      <img src="example1.jpg" style="width:100%;border-radius:6px;margin:8px 0;">
      <p>一、起源背景（清代）
        命名由来：与药帮大巷、一巷、三巷同源，均因“药帮”（河南怀庆府药材商帮）的活动而得名，是药帮在街区内部空间划分的序列化体现。
        形成时间：清代（推测在覃怀药王庙（1689年）建立后，随着药帮势力范围的巩固和扩展而逐渐形成）。
        功能与位置：
        位于覃怀药王庙的南侧或东南侧，是一条东西走向的巷道。
        其北侧为覃怀药王庙建筑群，南侧紧邻广东公所（岭南会馆）。因此，它在历史上是两大著名帮会——河南怀帮与广东帮——的重要地理分界线。
        是药帮巷弄系统中承上启下的一环，起到连接和划分不同功能区的作用。
        二、现状（截至论文撰写时）
        存续状态：已完全消失。
        消失原因：
        论文在“广东公所街区”部分明确指出，该片区内的里弄及老建筑（包括药帮二巷）均在1998年多福路扩建工程、汉正街批发市场修建中被拆除。
        原址上兴建了高层住宅（如全新社区）和商品批发大楼（如汉正街服饰批发市场）。
        原址现状：原址已被现代商业和住宅建筑彻底覆盖，无任何历史肌理留存。
        三、变迁过程
        清代：作为帮会边界形成
        药帮二巷作为药帮领域南缘的边界而存在，其南侧即是广东帮的势力范围。这条小巷物理上分割了两大商业巨头的空间，是行业地缘政治的微观体现。
        民国时期：功能延续与肌理填充
        其作为边界通道的功能继续存在。民国初年，其南侧的广东公所片区兴建了大量里分（如岭南里、广东巷），但药帮二巷本身作为街巷的走向和功能未被改变。
        计划经济时期：功能的消解与形态的暂存
        随着私营经济的消亡，药帮二巷作为商业边界的原始功能彻底消解。
        但其作为普通居民区的巷道物质形态很可能得以暂时保存下来，转变为生活性通道。
        市场经济时期（1998年）：肌理的彻底消亡
        直接驱动力：1998年的多福路扩建工程和汉正街批发市场的建设。
        这是市场经济时期“市场驱动” 下城市更新的典型结果。为了建设大型批发市场和拓宽城市干道，产权复杂、建筑密度高但经济价值被认为较低的传统历史街巷被成片拆除。
        药帮二巷所在的整个广东公所片区被完全推平，其物理形态从此消失，被全新的、尺度巨大的现代建筑所取代。<a href="#">查看更多</a></p>
    `},
            {x: 43.0, y: 63.5, title: '11.药帮三巷', desc: `
      <p>Yaobang 3 - Xiang 位于硚口区东南部，长堤街东段与大夹街之间。南北走向，南起药帮一巷，北至药帮二巷。长44米，宽约1米，泥土路面。门牌1 - 14号。清代成巷，附近有河南怀庆府药材帮会馆（又称药帮会馆），药材商行聚集于此，故称药帮巷。因支巷衍生交错，又分称大巷和一、二、三巷，此巷称三巷。1967年改名抗美大巷，1972年复名药帮三巷（聚寿里并入）。房屋低矮陈旧，居民稠密，巷道狭窄，仅可行人。</p>
      <img src="example1.jpg" style="width:100%;border-radius:6px;margin:8px 0;">
      <p>一、起源背景（清代）
        命名由来：与药帮大巷、一巷、二巷同源，是“药帮”（河南怀庆府药材商帮）在街区内部空间划分的序列化命名体系的组成部分。其序号“三”表明它是该系统中更次一级或更边缘的巷道。
        形成时间：清代（随覃怀药王庙的建立和药帮活动范围的扩展而逐渐形成）。
        功能与位置：
        位于覃怀药王庙的东南侧，是药帮巷弄系统中最东端的巷道之一。
        其具体位置论文未详细描述，但根据命名序列推断，应位于药帮一巷或二巷的东侧，可能更靠近徽州会馆街区。
        功能上服务于药帮成员的日常通行和货物运输，是药帮势力范围东侧的边界或内部通道。
        二、现状（截至论文撰写时）
        存续状态：已完全消失。
        消失原因：
        论文在“市场经济时期”的描述中提到，在街区东侧为修建友谊南路时，“占据街区内部街道，使得大陶家小巷、江口巷由此消失”。
        虽然未直接点名药帮三巷，但根据其位于街区东侧的位置判断，它与大陶家小巷、江口巷一样，在友谊南路的建设过程中被占据、拆除并消亡。
        原址现状：原址已被现代化的城市交通干道（友谊南路）及其附属空间所覆盖，历史痕迹无存。
        三、变迁过程
        清代：作为药帮网络末梢形成
        药帮三巷作为药帮巷弄系统向东延伸的“末梢”或边界而形成，标志着药帮地盘在东侧的极限。
        民国至计划经济时期：功能的淡化与肌理的暂存
        与其它药帮巷弄一样，其行业功能逐渐淡化并最终消失。
        但其作为街巷的物质形态，在计划经济时期很可能得以保留，转变为普通的居民区通道。
        市场经济时期（1990年代末/21世纪初）：肌理的彻底消亡
        直接驱动力：友谊南路的修建。
        这是与药帮二巷（西侧，因多福路扩建消失）相对应的、发生在街区东侧的现代城市交通建设对历史肌理的破坏。
        为了建设这条宽阔的现代城市干道，需要大规模的土地，药王庙街区东侧边缘地带的历史街巷因其“边缘”属性而首当其冲，被整体拆除让路。
        药帮三巷，连同大陶家小巷、江口巷等，在这一波开发浪潮中被彻底从地图上抹去。<a href="#">查看更多</a></p>
    `},
            {x: 53.5, y: 53.1, title: '12.元宁巷', desc: `
      <p></p>
      <img src="example1.jpg" style="width:100%;border-radius:6px;margin:8px 0;">
      <p>一、起源背景（清代）
        命名由来：因元宁公所而得名。元宁公所由江苏上元、江宁两县（今均属南京市）的旅汉人士于清乾隆三十六年（1771年）创建。
        形成时间：清代（随元宁公所的建立而自然形成）。
        功能与位置：
        位于药王庙街区东南侧的徽州会馆街区。
        是一条南北走向的巷道，北起六水街，南至药帮一巷。
        在历史上，它既是通往元宁公所的通道，也是划分西侧浙宁公所与东侧琴溪书院、伏波宫等建筑的界带。
        二、现状（截至论文撰写时）
        位置与形态：
        仍然存在，保留了其历史名称和基本走向。
        论文中虽未明确其尺度，但作为历史巷道，其形态应保持传统尺度。
        功能：
        从服务于特定公所的通道，转变为普通的社区内部生活巷道。
        文化价值：
        其名称是元宁公所及其所代表的地缘文化在街区留下的永久印记。
        关键价值：论文明确指出，元宁巷2号的元宁公所建筑是“街区中现存唯一的清代会馆”。因此，元宁巷是通往这片珍贵历史遗存的必经之路，其历史环境价值极高。
        三、变迁过程
        清代：因所成巷，功能明确
        元宁巷随着元宁公所的建立而成为街区路网的一部分，主要功能是服务于该公所的交通和空间组织。
        民国时期：肌理混杂与延续
        1911年大火及后续重建中，元宁巷的走向得以保留。其周边区域功能更加混杂，但巷道作为空间骨架的作用没有改变。
        计划经济时期：功能转变与肌理幸存
        元宁公所的建筑功能消亡，可能被改为民居或小作坊使用。
        肌理幸存：与北侧兴建“二色织布厂”和南侧其他变化相比，元宁巷及其旁的元宁公所建筑未被大规模改造项目波及，其历史肌理意外地得以保存下来。
        市场经济时期至今：成为历史“活化石”的通道
        肌理的存续：与东侧因修建友谊南路而消失的大陶家小巷等人为拆除不同，元宁巷因其位于街区内部，未受到现代交通干道的直接冲击，得以完整保存。
        价值的凸显：随着周边历史建筑的大量消失，元宁巷因其引道功能而价值倍增。它不再是一条普通小巷，而是通往药王庙街区唯一幸存的清代会馆建筑（元宁公所） 的路径，其自身也构成了该历史遗存环境的一部分。
        巷道两侧建筑虽也为不同时期层积，但整体保持了传统风貌<a href="#">查看更多</a></p>
    `},
            {x: 71.1, y: 63.0, title: '14.新安后街', desc: `
      <p>Xin'an Houjie 位于硚口区东南部，长堤街东段与大夹街之间，主巷南起大夹街，北至六水街。长约170米，宽约4米；支巷由北口转西，巷长约60米，宽约4米。水泥路面、门牌1－55号，2－32号。清代成街，附近有三皇殿，称三皇殿街。1967年改名灭资三巷，1972年改由新安街派生得名新安后街。两侧多二层砖木楼房排列整齐，居民稠密，巷道狭窄。不通汽车。</p>
      <img src="example1.jpg" style="width:100%;border-radius:6px;margin:8px 0;">
      <p>一、起源背景（清代）
        命名由来：名称直接源于新安书院（即徽州会馆）。“后街”指明了其位于这座重要地标建筑西侧或后部的空间位置。
        曾用名：历史上曾因三皇殿（另一座重要药商会馆）而得名“三皇殿街”。
        形成时间：清代（随新安书院（1695年）及周边建筑的建立而形成）。
        功能与位置：
        位于药王庙街区东南侧的徽州会馆街区，是一条南北走向的骨干巷道。
        北起六水街，南至大夹街。
        其东侧紧邻并平行于新安巷，共同构成了徽州会馆建筑群的西侧边界，是典型的“因馆成街”。
        历史上，它是徽州会馆区的内部通道，也串联起三皇殿等重要节点。
        二、现状（截至论文撰写时）
        位置与形态：
        仍然存在，保留了其历史名称和南北走向的基本肌理。
        是药王庙街区东南部保存较好的历史巷道之一。
        功能：
        从服务于会馆建筑的内部通道，转变为普通的社区生活巷道。
        文化价值：
        其名称是徽州会馆（新安书院）空间影响力的直接体现。
        关键价值：论文明确指出，在现代的新安后街上仍可见到新安书院界墙的残垣，以及界墙上“新安书院”四字的铭文。这使得新安后街不仅是一条街，其本身更是承载了历史实物证据的“露天博物馆”，是历史在物质上的沉淀和直接证明。
        三、变迁过程
        清代：作为会馆界街形成
        新安后街作为徽州会馆建筑群的西界和内部服务通道而存在，是其宏大规模的空间体现。
        民国时期：名称更迭与功能延续
        在1912年的汉口大火及后续重建中，其空间形态得以保留。
        其名称可能在“三皇殿街”与“新安后街”之间有过并存或更迭，反映了不同历史建筑在本地的影响力。
        计划经济时期：功能转型与肌理留存
        会馆功能消亡后，其转变为居民区巷道。
        肌理留存：与北侧兴建“二色织布厂”不同，新安后街的巷道肌理未被大规模工业建设所破坏，得以完整保存下来。
        市场经济时期至今：成为历史见证的走廊
        肌理的存续：与东侧被友谊南路吞噬的大陶家小巷不同，新安后街因其纵深方向与道路扩建方向平行，且不在核心拆迁范围内，再次幸运地避开了毁灭性改造。
        价值的升华：随着徽州会馆主体建筑的湮灭，新安后街因其保留了唯一的实物遗迹（界墙残垣与铭文） 而价值剧增。它从一条辅助街道，升华为整个徽州会馆历史存在的最重要物质见证。
        街道两侧变为民宅和商铺，但行走其间仍能感受到历史的分量。<a href="#">查看更多</a></p>
    `},
            {x: 75.2, y: 63.5, title: '15.新安街', desc: `
      <p>Xin'an Jie 位于硚口区东部，长堤街以南，南北走向。南起大夹街北至六水街街口（接台街）。长约177米，宽约5.6米。水泥路面。可行汽车。门牌1－56号。清代老街，以旧有“新安书院”而得名。康熙七年（1668），由徽属六邑歙、休、祁、黟、绩仕商组合；在此初建“新安公所”。后于康熙三十四年（1695）又改建“新安书院”，创办学堂。1735年在汉江边辟新安码头，建奎星阁、紫阳坊。1776年修新安街道。1852年至1911年期间，书院曾先后两次被毁，又复重修。民国后，此处曾为药材、参燕、百货商店、行栈集聚之地，有新安市场之称。现为居民区，1967年一度改名文革街，1972年恢复原名。仍保留古老街道面貌。多砖木结构楼房，分布有街办工厂及商业服务网点。</p>
      <img src="example1.jpg" style="width:100%;border-radius:6px;margin:8px 0;">
      <p>一、起源背景（清代）
        命名由来：名称直接源于新安书院（即徽州会馆）。新安是徽州的古称，因此这条街是徽州商帮在汉口核心势力的空间标志和地缘领土的宣示。
        形成时间：清代（随新安书院（1695年）的建立和繁荣而逐渐形成）。
        功能与位置：
        位于药王庙街区东南侧的徽州会馆街区，是一条东西走向的街道。
        它与新安巷、新安后街共同构成了一个以新安书院为核心的、带有自我标识性的街道命名系统。
        历史上，它是徽州会馆建筑群前部或周边的重要街道，很可能曾是徽商贸易和活动的活跃区域。
        二、现状（截至论文撰写时）
        位置与形态：
        仍然存在，保留了其历史名称。
        论文中未明确描述其具体尺度和详细现状，但作为历史街道，其基本走向得以延续。
        功能：
        从徽商商业活动的核心区域，转变为普通的社区生活性街道。
        文化价值：
        其名称是徽州会馆及其所代表的徽商文化在药王庙街区留下的最显著、最直接的空间印记之一。
        它与新安巷、新安后街一同，构成了一个完整的“新安”地名系统，是追溯徽商历史地理的重要线索。
        三、变迁过程
        清代：因馆成街，商业繁盛
        新安街随着新安书院的建立而发展，成为徽商聚集区的重要街道，两侧很可能遍布徽州商人的店铺和货栈，商业氛围浓厚。
        民国时期：延续与扰动
        其街道形态和名称在1911年大火及后续重建中得以保留。尽管经历了战乱，但作为街区骨干路网的一部分，其空间结构表现出稳定性。
        计划经济时期：功能转型与肌理留存
        私营商业的消失使得新安街的原始功能终结，转变为以居住为主的街道。
        肌理留存：与北侧单元格兴建“二色织布厂”不同，新安街的街道肌理未被大规模工业建设所破坏，得以保存。
        市场经济时期至今：名称的存续与环境的更替
        肌理的存续：与东侧被友谊南路吞噬的大陶家小巷等人为拆除不同，新安街因其走向与改造方向可能不冲突，且不在核心拆迁范围内，其街道形态得以完整保留。
        环境的更替：虽然街道还在，但其历史环境已彻底改变。论文指出，徽州会馆（新安书院）的主要建筑在民国初年就已大部损毁，“只剩偏亭一间”，至现代已完全湮灭。因此，新安街从一个“实至名归”的会馆核心街，转变为一条“名存实亡”的街道——其名称依然响亮，但其得名之源（壮观的会馆建筑群）和原有的商业功能已消失殆尽。
        现今，街道两侧应为不同时期的民宅和小型店铺，其历史氛围需要通过地名和零星的遗迹（如新安后街的界墙残垣）去想象和追溯。<a href="#">查看更多</a></p>
    `},
            {x: 79.1, y: 64.1, title: '16.新安巷', desc: `
      <p></p>
      <img src="example1.jpg" style="width:100%;border-radius:6px;margin:8px 0;">
      <p>一、起源背景（清代）
        命名由来：名称直接源于新安书院（即徽州会馆）。与“新安街”、“新安后街”共同构成了一个完整的、以“新安”命名的徽商地缘空间标识系统。
        形成时间：清代（随新安书院（1695年）的建立和其建筑群的空间组织需求而形成）。
        功能与位置：
        位于药王庙街区东南侧的徽州会馆街区，是一条南北走向的巷道。
        其西侧紧邻并平行于新安后街，两者共同定义了徽州会馆建筑群的西侧边界。
        在历史上，它是会馆建筑群内部的通道，很可能承担着礼仪、服务或分隔不同功能院落的作用。

        二、现状（截至论文撰写时）
        位置与形态：
        仍然存在，保留了其历史名称和基本走向。
        论文中虽未明确其尺度，但作为历史巷道，其形态应保持传统尺度。
        功能：
        从会馆内部的专用通道，转变为普通的社区内部生活巷道。
        文化价值：
        其名称是徽州会馆空间影响力的直接体现，是“新安”地名系统的重要组成部分。
        它与新安后街一起，共同框定了历史上徽州会馆的西部范围，是理解该会馆历史尺度和空间组织的关键地理坐标。

        三、变迁过程
        清代：作为会馆界巷形成
        新安巷作为徽州会馆建筑群的组成部分而被规划和命名，是其宏大、有序的空间结构的体现。
        民国时期：肌理延续
        在1911年大火及后续的城市重建中，新安巷作为街区路网的稳定组成部分，其走向和位置得以保留。
        计划经济时期：功能转型与肌理留存
        会馆功能消亡后，其转变为居民区巷道。
        肌理留存：与北侧兴建“二色织布厂”等工业改造不同，新安巷的肌理未被大规模建设所破坏，得以保存。
        市场经济时期至今：肌理的存续与语境的变迁
        肌理的存续：与东侧被友谊南路吞噬的大陶家小巷等人为拆除不同，新安巷因其位于街区内部，未受到现代交通干道的直接冲击，其巷道肌理得以完整保存至今。
        语境的变迁：虽然街道形态得以保留，但其空间语境已彻底改变。它所服务的核心——壮观的徽州会馆建筑群——早已湮灭（民国初年就已大部损毁）。因此，它从一个宏大会馆综合体的内部通道，转变为一条被普通民宅包围的寂静小巷。
        它的存在，与其姊妹巷“新安后街”上残存的界墙铭文一起，默默地标识着一段辉煌历史的过去式。<a href="#">查看更多</a></p>
    `},
            {x: 45.0, y: 76.7, title: '17.大生巷', desc: `
      <p></p>
      <img src="example1.jpg" style="width:100%;border-radius:6px;margin:8px 0;">
      <p>一、起源背景（清代）
        命名由来：论文中未明确解释其命名起源。根据汉口街巷常见的命名规律（如大兴巷、广利巷），“大生”二字很可能寓意“大兴生意”，反映了当时商贾对商业繁荣的吉祥祈愿。
        形成时间：清代（论文中提及该巷“清代成巷”）。
        功能与位置：
        位于药王庙街区南部的广东公所街区（岭南会馆所在地）。
        在历史上，它是岭南会馆建筑群的东侧边界。论文明确指出，岭南会馆（广东公所）“东抵大生巷”。
        是其所在区域历史街巷网络的组成部分之一。
        二、现状（截至论文撰写时）
        存续状态：已完全消失。
        消失原因：
        论文在“广东公所街区”部分明确指出，该片区内的里弄及老建筑（包括大生巷）均在1998年多福路扩建工程、汉正街批发市场修建中被拆除。
        原址上兴建了高层住宅（如“全新社区”）和商品批发大楼（如“同润大厦”）。
        原址现状：原址已被现代商业和住宅建筑彻底覆盖，无任何历史肌理留存。
        三、变迁过程
        清代：作为会馆边界形成
        大生巷随着广东公所（1712年）的建立和发展而成为街区肌理的一部分。它作为广东帮商业领域的东侧界限而存在。
        民国时期：功能延续与肌理填充
        其作为边界通道的功能继续存在。民国初年，其所在的广东公所片区兴建了大量里分（如积润里、同润里），但大生巷本身作为街巷的走向和功能未被改变。
        计划经济时期：功能的消解与形态的暂存
        随着私营经济的消亡，大生巷作为商业边界的原始功能彻底消解。
        但其作为普通居民区的巷道物质形态很可能得以暂时保存下来。
        市场经济时期（1998年）：肌理的彻底消亡
        直接驱动力：1998年的多福路扩建工程和汉正街批发市场的建设。
        这是市场经济时期“市场驱动” 下城市更新的典型结果。为了追求土地的经济效益和现代化城市形象，整个广东公所片区被视作“棚户区”而进行成片整体开发。
        大生巷与其所在的整个街区肌理被完全推平，其物理形态从此消失，被全新的、尺度巨大的现代建筑所取代。<a href="#">查看更多</a></p>
    `},
            {x: 31.0, y: 55.6, title: '18.全新巷', desc: `
      <p></p>
      <img src="example1.jpg" style="width:100%;border-radius:6px;margin:8px 0;">
      <p>一、起源背景（现代）
        命名由来：名称源于全新街，而“全新”二字本身就意味着“全部新建”，是一个典型的现代命名，反映了其并非历史形成，而是现代城市开发的产物。
        形成时间：1998年（作为汉正街改造项目的一部分）。
        功能与位置：
        位于原广东公所街区的西北侧。
        它是1998年推平整个广东公所片区（包括岭南会馆、大生巷、药帮二巷等）后，在新建的“全新社区”内规划的内部道路。
        其功能是服务于新建的住宅小区，完全不同于历史上自然形成的、为商业和居住混合服务的传统街巷。
        二、现状（截至论文撰写时）
        位置与形态：
        作为现代道路存在。
        它是“全新社区”这个现代化住宅小区的组成部分。
        其尺度、规划和风貌完全不同于周边幸存的历史巷道（如六水街、药帮一巷）。
        功能：
        作为商品房住宅小区的内部通行道路和消防通道。
        文化价值：
        它不具备历史文化价值，其价值是功能性的。
        它的存在，恰恰标志着一段历史的彻底终结和一个新的、同质化的现代城市肌理的开端。它是一种“断裂”的象征。
        三、变迁过程
        1998年前：历史肌理时期
        在全新巷出现之前，该区域是药王庙街区历史层积中丰富的“广东公所街区”，分布着岭南会馆、大生巷、药帮二巷以及国华里、积润里、同润里等众多里弄，街巷肌理复杂而有机。
        1998年：彻底消亡与重建（转折点）
        直接驱动力：1998年的多福路扩建工程和汉正街批发市场建设。
        整个广东公所片区被整体拆除，所有历史建筑和街巷肌理被彻底抹平。
        在原址上，规划建设了新的道路和住宅小区，“全新巷”作为新小区的一条内部道路被命名和修建。它的诞生，意味着旧肌理的彻底死亡。
        1998年后至今：作为现代功能体存在
        全新巷作为现代化居住区的组成部分稳定存在，其功能单一，形态规则，与历史无关。<a href="#">查看更多</a></p>
    `},
            {x: 57.2, y: 93.8, title: '19.大夹街', desc: `
      <p>大夹街西起广货巷，东至民族路，长925米，宽5~6米，水泥路面。此街已有300多年历史，因位于汉正街与长堤街之间，故名夹街，又因另有小夹街平行，故名大夹街。街面多建两层楼房，人烟稠密。1990年后，该街逐渐形成汉正街服装市场，市场范围包括永茂里服装市场、新台童装市场、长虹服装市场、三曙街时装市场、雅端巷童装市场、全新街精品服装市场、升基巷童装市场、九如巷西服市场、新安街牛仔服市场、永大服装市场等，市场内人头攒动，生意红火。</p>
      <img src="example1.jpg" style="width:100%;border-radius:6px;margin:8px 0;">
      <p>一、起源背景（清代中期）
        命名由来：“夹街”意为正街（汉正街）之后的又一条平行大街。与汉正街、长堤街（原袁公堤）共同构成了汉口老城区“两堤夹一街”的核心骨架格局。
        形成时间：清代中期（即17世纪晚期至18世纪晚期之间）。论文引用《汉口丛谈》记载，证实其在道光初年（1820年代）已作为汉口两条最长的街道之一而闻名。
        功能与位置：
        位于汉正街以北，与汉正街平行，是药王庙街区的南侧边界。
        在历史上，它是仅次于汉正街的繁华商业街，是汉口商业中心由河岸向内陆扩展的第二层核心区域。
        其南侧（汉正街一侧）地价和地位更高，北侧（药王庙街区一侧）相对次之，形成了清晰的空间等级。
        二、现状（截至论文撰写时）
        位置与形态：
        仍然存在，并且依然是药王庙街区的南界主干道。
        论文中描述其长约154米，宽约5米，但此数据可能仅指药王庙街区段，其全线长度远不止于此。
        其作为城市交通干道的功能依然重要。
        功能：
        从传统的商业街，转变为集商业、居住、交通于一体的综合性城市道路。其一层界面多为商铺，延续了历史上的商业功能。
        文化价值：
        是汉口古镇“两堤夹一街”历史空间结构的最核心组成部分之一，是街区历史范围的关键界定要素。
        其名称和走向自清代以来未有改变，是汉口城市记忆中最稳定的地理坐标之一。
        三、变迁过程
        清代：商业扩张的产物与核心主干道
        大夹街的形成是汉口商业繁荣、城市空间向北扩张的必然结果。随着汉正街沿岸空间饱和，商人居民向北部腹地发展，从而在汉正街后方形成了这条平行的“夹街”。
        它迅速发展成为繁华的商业副中心，其繁荣程度仅次于汉正街。
        民国时期：延续繁华与经受冲击
        其商业功能和文化地位得以延续。
        经历了1911年等战火的破坏，但其作为城市主干道的空间地位没有动摇，在战后得以重建。
        计划经济时期：功能转变与肌理稳定
        私营商业被公有制取代，大夹街的传统商业功能减弱，转变为生活性主干道。
        其街道尺度、走向和名称保持了极高的稳定性，未因大型工业项目建设而改变。
        市场经济时期至今：商业复兴与语境变迁
        商业复兴：改革开放后，尤其是汉正街小商品市场兴起以来，大夹街的底层商业功能重新焕发活力，再次成为热闹的商业街，但经营内容和形式已完全不同。
        肌理存续：与许多内部小巷（如药帮二巷、大生巷）被彻底拆除不同，大夹街作为重要的城市主干道，其线性的空间形态得到了完整的保留。
        语境变迁：虽然街道还在，但其两侧的建筑界面经历了多次更新，传统建筑大多被现代砖混或多层建筑所替代。其空间角色从“历史商业核心”转变为“现代城市商业环境中的历史道路”。<a href="#">查看更多</a></p>
    `}
        ];
        let imgNatural = {w: 0, h: 0};
        let buttonsBuilt = false;

        
        function computeImageRect(mapEl) {
            // 计算 background-size: contain 下图片在容器中的真实显示区域
            const cw = mapEl.clientWidth;
            const ch = mapEl.clientHeight;
            const iw = imgNatural.w;
            const ih = imgNatural.h;
            if (!cw || !ch || !iw || !ih) {
                return {x:0, y:0, w:cw, h:ch};
            }
            const imgRatio = iw / ih;
            const boxRatio = cw / ch;
            let w, h, x, y;
            if (boxRatio > imgRatio) {
                // 以高为基准，左右留白
                h = ch;
                w = h * imgRatio;
                x = (cw - w) / 2;
                y = 0;
            } else {
                // 以宽为基准，上下留白
                w = cw;
                h = w / imgRatio;
                x = 0;
                y = (ch - h) / 2;
            }
            return {x, y, w, h};
        }

        function buildButtons() {
            if (buttonsBuilt) return;
            const layer = document.getElementById('buttons-layer');
            layer.innerHTML = '';
            pointData.forEach((pt, i) => {
                const btn = document.createElement('div');
                btn.className = 'map-button';
                btn.dataset.xpct = pt.x;
                btn.dataset.ypct = pt.y;
                btn.title = pt.title || ('点 ' + (i + 1));
                // 弹框
                // const tip = document.createElement('div');
                // //tip.className = 'map-tooltip';
                // tip.innerHTML = '<strong>' + (pt.title || ('点 ' + (i + 1))) + '</strong><br>' + (pt.desc || '');
                // btn.appendChild(tip);

                // 点击可自定义行为
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    // 点击波纹动画
                    try {
                        const old = btn.querySelector('.click-ripple');
                        if (old) old.remove();
                        const ripple = document.createElement('div');
                        ripple.className = 'click-ripple';
                        btn.appendChild(ripple);
                        ripple.addEventListener('animationend', () => ripple.remove());
                    } catch(_) {}

                    const panel = document.getElementById('info-panel');
                    panel.querySelector('.info-panel-header').innerText = pt.title;
                    panel.querySelector('.info-panel-content').innerHTML = pt.desc;

                    // 显示并加动画
                    panel.style.display = 'block';
                    setTimeout(() => panel.classList.add('show'), 10);
                });

                layer.appendChild(btn);
            });
            buttonsBuilt = true;
            layoutButtons(); // 初次定位
        }

        function layoutButtons() {
            const mapEl = document.getElementById('map-2024');
            const rect = computeImageRect(mapEl);
            const layer = document.getElementById('buttons-layer');
            const nodes = layer.querySelectorAll('.map-button');
            nodes.forEach(node => {
                const xp = parseFloat(node.dataset.xpct);
                const yp = parseFloat(node.dataset.ypct);
                const left = rect.x + rect.w * (xp / 100);
                const top  = rect.y + rect.h * (yp / 100);
                node.style.left = left + 'px';
                node.style.top  = top + 'px';
            });
        }

        // 初始化所有地图
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化四个地图
            initMap('map-2024');
            initMap('map-1966');
            initMap('map-1938');
            initMap('map-1861');

            // 时间轴点击事件
            document.querySelectorAll('.time-marker').forEach(marker => {
                marker.addEventListener('click', function() {
                    const year = this.getAttribute('data-year');
                    setActiveMap(maps[`map-${year}`]);

                    // 将选中的地图居中显示（在响应式布局中有用）
                    if (window.innerWidth <= 900) {
                        const mapElement = document.getElementById(`map-${year}`);
                        mapElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                });
            });

            // 同步地图按钮
            document.getElementById('sync-maps').addEventListener('click', function() {
                isSyncing = !isSyncing;
                this.textContent = isSyncing ? '锁定地图' : '同步地图';
                this.style.backgroundColor = isSyncing ? '#4dabf7' : '#868e96';
            });

            // 搜索功能 - 对于静态图片，这个功能不再需要
            document.getElementById('search-btn').addEventListener('click', function() {
                const location = document.getElementById('location-search').value;
                if (location) {
                    alert('静态图片模式不支持搜索定位功能');
                }
            });

            // 全屏按钮事件
            document.querySelectorAll('.fullscreen-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const mapId = this.getAttribute('data-map');
                    toggleFullscreen(mapId);
                    // 全屏切换后重新布局
                    setTimeout(layoutButtons, 50);
                });
            });

            // 退出全屏按钮事件
            document.querySelectorAll('.exit-fullscreen-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const mapWrapper = this.closest('.map-wrapper');
                    const mapId = mapWrapper.querySelector('.map').id;
                    toggleFullscreen(mapId);
                    setTimeout(layoutButtons, 50);
                });
            });

            // 地图点击事件、滚轮缩放事件和拖拽事件
            document.querySelectorAll('.map').forEach(map => {
                map.addEventListener('click', function(e) {
                    // 只有在没有拖拽时才触发点击事件
                    if (!isDragging) {
                        setActiveMap(this);
                    }
                });

                // 添加鼠标滚轮缩放事件
                map.addEventListener('wheel', function(e) {
                    e.preventDefault(); // 阻止页面滚动

                    const mapId = this.id;
                    const direction = e.deltaY < 0 ? 'in' : 'out';
                    zoomMap(mapId, direction);
                });

                // 鼠标按下事件 - 开始拖拽
                map.addEventListener('mousedown', function(e) {
                    if (e.button === 0) { // 只响应左键
                        isDragging = true;
                        currentDragMap = this.id;
                        this.classList.add('dragging');

                        dragStart.x = e.clientX - mapPositions[this.id].x;
                        dragStart.y = e.clientY - mapPositions[this.id].y;

                        e.preventDefault();
                    }
                });
            });

            // 鼠标移动事件 - 拖拽中
            document.addEventListener('mousemove', function(e) {
                if (isDragging && currentDragMap) {
                    const newX = e.clientX - dragStart.x;
                    const newY = e.clientY - dragStart.y;

                    mapPositions[currentDragMap].x = newX;
                    mapPositions[currentDragMap].y = newY;

                    updateMapTransform(currentDragMap);

                    // 如果同步功能开启，同步其他地图
                    if (isSyncing && !fullscreenMode) {
                        syncMaps(maps[currentDragMap]);
                    }
                }
            });

            // 鼠标松开事件 - 结束拖拽
            document.addEventListener('mouseup', function(e) {
                if (isDragging && currentDragMap) {
                    isDragging = false;
                    const mapElement = maps[currentDragMap];
                    if (mapElement) {
                        mapElement.classList.remove('dragging');
                    }
                    currentDragMap = null;
                }
            });

            // 缩放按钮事件
            document.querySelectorAll('.zoom-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const mapId = this.getAttribute('data-map');
                    const action = this.getAttribute('data-action');
                    const direction = action === 'zoom-in' ? 'in' : 'out';
                    zoomMap(mapId, direction);
                });
            });

            // 回归中心点按钮事件
            document.querySelectorAll('.center-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const mapId = this.getAttribute('data-map');
                    centerMap(mapId);
                });
            });

            // 监听全屏变化事件（退出全屏时）
            document.addEventListener('fullscreenchange', handleFullscreenChange);
            document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
            document.addEventListener('mozfullscreenchange', handleFullscreenChange);
            document.addEventListener('MSFullscreenChange', handleFullscreenChange);

            function handleFullscreenChange() {
                if (!document.fullscreenElement && 
                    !document.webkitFullscreenElement && 
                    !document.mozFullScreenElement &&
                    !document.msFullscreenElement) {
                    // 已退出全屏模式
                    document.querySelectorAll('.map-wrapper').forEach(wrapper => {
                        wrapper.classList.remove('fullscreen');
                    });
                    fullscreenMode = false;
                    setTimeout(layoutButtons, 50);
                }
            }

            // 载入2024底图的原始尺寸，用于百分比->像素定位
            const img = new Image();
            img.src = 'wcx/2024.png';
            img.onload = () => {
                imgNatural.w = img.naturalWidth;
                imgNatural.h = img.naturalHeight;
                buildButtons();
                layoutButtons();
            };

            // 窗口尺寸变化时重算（应对小图/响应式/全屏）
            window.addEventListener('resize', () => {
                layoutButtons();
            });
        });
                

            // 打开/更新右侧面板
        function showInfoPanel(title, content) {
            const panel = document.getElementById('info-panel');
            panel.querySelector('.info-panel-header').textContent = title;
            panel.querySelector('.info-panel-content').innerHTML = content; // 支持HTML
            panel.style.display = 'block';
            // 每次打开把面板位置重置在右侧
            panel.style.top = '80px';
            panel.style.right = '20px';
            panel.style.left = 'auto';
        }

        // 关闭面板
        document.querySelector('.info-panel-close').addEventListener('click', () => {
            const panel = document.getElementById('info-panel');
            // 触发退出动画
            panel.classList.remove('show');
            panel.classList.add('hiding');
            // 动画结束后隐藏并清理状态
            const onEnd = () => {
                panel.style.display = 'none';
                panel.classList.remove('hiding');
                panel.removeEventListener('animationend', onEnd);
            };
            panel.addEventListener('animationend', onEnd);
        });


        // --- 面板可拖动 ---
        (function makePanelDraggable() {
            const panel = document.getElementById('info-panel');
            const header = panel.querySelector('.info-panel-header');
            let offsetX = 0, offsetY = 0, isDown = false;

            header.addEventListener('mousedown', function(e) {
                isDown = true;
                offsetX = e.clientX - panel.offsetLeft;
                offsetY = e.clientY - panel.offsetTop;
                document.body.style.userSelect = 'none';
            });

            document.addEventListener('mousemove', function(e) {
                if (!isDown) return;
                panel.style.left = (e.clientX - offsetX) + 'px';
                panel.style.top = (e.clientY - offsetY) + 'px';
                panel.style.right = 'auto'; // 固定右侧值取消
            });

            document.addEventListener('mouseup', function() {
                isDown = false;
                document.body.style.userSelect = 'auto';
            });
        })();

        function movePanelInto(mapWrapper) {
            const panel = document.getElementById('info-panel');
            if (!mapWrapper.contains(panel)) {
                mapWrapper.appendChild(panel);
                panel.style.position = 'absolute';
                panel.style.top = '20px';
                panel.style.right = '20px';
            }
        }

        function movePanelBack() {
            const panel = document.getElementById('info-panel');
            if (panel.parentNode !== document.body) {
                document.body.appendChild(panel);
                panel.style.position = 'fixed';
                panel.style.top = '80px';
                panel.style.right = '20px';
            }
        }

        document.addEventListener('fullscreenchange', function() {
            const fsEl = document.fullscreenElement;
            if (fsEl && fsEl.classList.contains('map-wrapper')) {
                movePanelInto(fsEl);
            } else {
                movePanelBack();
            }
        });

    </script>
</body>
</html>
